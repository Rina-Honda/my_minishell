# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    memo.txt                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: rhonda <rhonda@student.42.fr>              +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/03/09 00:54:47 by rhonda            #+#    #+#              #
<<<<<<< Updated upstream
#    Updated: 2025/03/19 01:07:43 by rhonda           ###   ########.fr        #
=======
#    Updated: 2025/03/18 13:24:11 by rhonda           ###   ########.fr        #
>>>>>>> Stashed changes
#                                                                              #
# **************************************************************************** #

todo

// change function
strcmp - OK
strndup -  OK
fcntl - OK
strtol - OK
dprintf - OK

//file 
4: read
2: write
1: exec
読み書き実行4, 2, 1

// 環境によって違いそうなので要確認
exit の引数が数字じゃない時のerror code
→bashの場合、exit code は符号なし8bit整数になる（= unsigned char）

unset の引数が変数名の規則に則ってないときのexit code

unset identifierルールの影響で$PATHできない
minishell: unset: `/home/rhonda/.local/bin:/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Program: not a valid identifier
校舎でも同じだった
minishell$ unset $HOME
minishell: unset: `/home/rhonda: not a valid identifier
→unset $いらない変数名で指定する

// out stream
stderrを解除する

//todo
leak
norm - OK
使用禁止関数 - OK
(pipeline)
global
infinite_loop.c memo.txtを消す

//final check
leak
norm
使用禁止関数使ってないか
いらないファイル残ってないか


rhonda@TABLET-PM80C8FG:~/minishell/my_minishell$ valgrind --leak-check=full --show-leak-kinds=all --suppressions=.suppression ./minishell
==4893== Memcheck, a memory error detector
==4893== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==4893== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==4893== Command: ./minishell
==4893==
minishell$ ls | pwd
==4914== Warning: invalid file descriptor -1 in syscall close()
/home/rhonda/minishell/my_minishell
==4914==
==4914== HEAP SUMMARY:
==4914==     in use at exit: 213,126 bytes in 350 blocks
==4914==   total heap usage: 651 allocs, 301 frees, 243,324 bytes allocated
==4914==
==4914== 2 bytes in 1 blocks are still reachable in loss record 1 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F7B7: ft_strdup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AAE6: operator (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A677: tokenize (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A4E8: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 3 bytes in 1 blocks are still reachable in loss record 2 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10B4C8: append_char (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BE5D: remove_quote_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BEFA: expand_quote_removal_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BF3A: expand_quote_removal_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B580: expand (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A546: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 4 bytes in 1 blocks are still reachable in loss record 3 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10B4C8: append_char (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BE5D: remove_quote_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BEFA: expand_quote_removal_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BF3A: expand_quote_removal_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10BF4A: expand_quote_removal_recursive (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B580: expand (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A546: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 7 bytes in 2 blocks are still reachable in loss record 4 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10EE0A: ft_strndup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AEAC: word (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A6B0: tokenize (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A4E8: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 9 bytes in 1 blocks are still reachable in loss record 7 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x489BBAC: xmalloc (in /usr/lib/x86_64-linux-gnu/libreadline.so.8.1)
==4914==    by 0x4879694: readline_internal_teardown (in /usr/lib/x86_64-linux-gnu/libreadline.so.8.1)
==4914==    by 0x4883D2A: readline (in /usr/lib/x86_64-linux-gnu/libreadline.so.8.1)
==4914==    by 0x10A5A4: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 24 bytes in 1 blocks are still reachable in loss record 18 of 84
==4914==    at 0x484DA83: calloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10D2B4: map_new (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D15D: init_env (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A586: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 24 bytes in 1 blocks are still reachable in loss record 21 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB70: new_token (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB2B: operator (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A677: tokenize (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A4E8: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 24 bytes in 1 blocks are still reachable in loss record 22 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB70: new_token (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A6FE: tokenize (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A4E8: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 24 bytes in 1 blocks are still reachable in loss record 23 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB70: new_token (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10ABF3: tokendup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B1F3: append_command_elem (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B427: simple_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFB1: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 24 bytes in 1 blocks are still reachable in loss record 24 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB70: new_token (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10ABF3: tokendup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B1F3: append_command_elem (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B427: simple_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFB1: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFEA: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 48 bytes in 2 blocks are still reachable in loss record 29 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AB70: new_token (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AEE2: word (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A6B0: tokenize (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A4E8: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 88 bytes in 1 blocks are still reachable in loss record 31 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF27: new_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF6E: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 88 bytes in 1 blocks are still reachable in loss record 32 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF27: new_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B40C: simple_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFB1: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 88 bytes in 1 blocks are still reachable in loss record 33 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF27: new_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF6E: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFEA: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 88 bytes in 1 blocks are still reachable in loss record 34 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF27: new_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10B40C: simple_command (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFB1: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AFEA: pipeline (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10AF07: parse (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A51F: interpret (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A5DC: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 397 bytes in 36 blocks are still reachable in loss record 41 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F7B7: ft_strdup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D545: map_insert (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D622: map_set (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D75A: map_put (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D13B: init_envmap (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D17D: init_env (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A586: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 864 bytes in 36 blocks are still reachable in loss record 45 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F754: ft_calloc (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D7B1: item_new (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D550: map_insert (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D622: map_set (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D75A: map_put (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D13B: init_envmap (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D17D: init_env (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A586: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== 3,100 bytes in 36 blocks are still reachable in loss record 59 of 84
==4914==    at 0x4848899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)
==4914==    by 0x10F7B7: ft_strdup (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D536: map_insert (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D622: map_set (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D75A: map_put (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D13B: init_envmap (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10D17D: init_env (in /home/rhonda/minishell/my_minishell/minishell)
==4914==    by 0x10A586: main (in /home/rhonda/minishell/my_minishell/minishell)
==4914==
==4914== LEAK SUMMARY:
==4914==    definitely lost: 0 bytes in 0 blocks
==4914==    indirectly lost: 0 bytes in 0 blocks
==4914==      possibly lost: 0 bytes in 0 blocks
==4914==    still reachable: 4,906 bytes in 125 blocks
==4914==         suppressed: 208,220 bytes in 225 blocks
==4914==
==4914== For lists of detected and suppressed errors, rerun with: -s
==4914== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)


★クオテーションの仕様手本
rhonda@TABLET-PM80C8FG:~/minishell/my_minishell$ echo "$USER" '$USER' "'$USER'" '"$USER"' ""$USER"" ''$USER''
rhonda $USER 'rhonda' "$USER" rhonda rhonda